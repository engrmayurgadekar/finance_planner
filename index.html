<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personal Finance Planner - Auto Sync</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Icons
        const Download = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="7 10 12 15 17 10"></polyline>
                <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg>
        );

        const Refresh = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="23 4 23 10 17 10"></polyline>
                <polyline points="1 20 1 14 7 14"></polyline>
                <path d="m3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
            </svg>
        );

        const CreditCard = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect>
                <line x1="1" y1="10" x2="23" y2="10"></line>
            </svg>
        );

        const Plus = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
        );

        const Edit = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
            </svg>
        );

        const Save = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                <polyline points="17,21 17,13 7,13 7,21"></polyline>
                <polyline points="7,3 7,8 15,8"></polyline>
            </svg>
        );

        const FinancePlanner = () => {
            const [activeTab, setActiveTab] = useState('overview');
            const [financeData, setFinanceData] = useState(null);
            const [isLoading, setIsLoading] = useState(true);
            const [editingLoan, setEditingLoan] = useState(null);
            const [showEMIPayment, setShowEMIPayment] = useState(false);

            // Initialize default data
            const initializeDefaultData = () => ({
                personalInfo: {
                    Monthly_Salary: 58000,
                    Name: 'Your Name',
                    Last_Updated: new Date().toISOString().split('T')[0]
                },
                monthlyExpenses: [
                    { id: 1, Expense_Category: 'Home_Loan_EMI', Amount: 24000, Priority: 'High', Is_Fixed: true },
                    { id: 2, Expense_Category: 'Bike_EMI', Amount: 4000, Priority: 'Medium', Is_Fixed: true },
                    { id: 3, Expense_Category: 'Education_Loan_EMI', Amount: 4000, Priority: 'High', Is_Fixed: true },
                    { id: 4, Expense_Category: 'Society_Loan_EMI', Amount: 5800, Priority: 'Medium', Is_Fixed: true },
                    { id: 5, Expense_Category: 'SIP_Investments', Amount: 15000, Priority: 'High', Is_Fixed: true },
                    { id: 6, Expense_Category: 'Personal_Expenses', Amount: 5000, Priority: 'Medium', Is_Fixed: false }
                ],
                loansTracker: [
                    { 
                        id: 1,
                        Loan_Name: 'Home Loan', 
                        Loan_Type: 'Home',
                        Principal_Amount: 3000000,
                        EMI_Amount: 24000, 
                        Interest_Rate: 8.5,
                        Original_Tenure_Months: 240,
                        Remaining_Tenure_Months: 120, 
                        Outstanding_Amount: 2500000,
                        Start_Date: '2020-01-01',
                        Expected_End_Date: '2040-01-01',
                        Bank_Lender: 'SBI',
                        Last_Payment_Date: null,
                        Payments_Made: []
                    },
                    { 
                        id: 2,
                        Loan_Name: 'Bike EMI', 
                        Loan_Type: 'Vehicle',
                        Principal_Amount: 100000,
                        EMI_Amount: 4000, 
                        Interest_Rate: 12.0,
                        Original_Tenure_Months: 25,
                        Remaining_Tenure_Months: 20, 
                        Outstanding_Amount: 80000,
                        Start_Date: '2023-06-01',
                        Expected_End_Date: '2025-06-01',
                        Bank_Lender: 'HDFC',
                        Last_Payment_Date: null,
                        Payments_Made: []
                    },
                    { 
                        id: 3,
                        Loan_Name: 'Education Loan', 
                        Loan_Type: 'Education',
                        Principal_Amount: 200000,
                        EMI_Amount: 4000, 
                        Interest_Rate: 7.5,
                        Original_Tenure_Months: 50,
                        Remaining_Tenure_Months: 40, 
                        Outstanding_Amount: 150000,
                        Start_Date: '2021-08-01',
                        Expected_End_Date: '2025-08-01',
                        Bank_Lender: 'Canara Bank',
                        Last_Payment_Date: null,
                        Payments_Made: []
                    },
                    { 
                        id: 4,
                        Loan_Name: 'Society Loan', 
                        Loan_Type: 'Personal',
                        Principal_Amount: 120000,
                        EMI_Amount: 5800, 
                        Interest_Rate: 15.0,
                        Original_Tenure_Months: 20,
                        Remaining_Tenure_Months: 18, 
                        Outstanding_Amount: 100000,
                        Start_Date: '2023-01-01',
                        Expected_End_Date: '2024-08-01',
                        Bank_Lender: 'Society',
                        Last_Payment_Date: null,
                        Payments_Made: []
                    }
                ],
                sipInvestments: [
                    { id: 1, SIP_Name: 'Equity SIP', Fund_Type: 'Equity', Monthly_Amount: 7000, Current_Value: 150000, Expected_Return: 12.0 },
                    { id: 2, SIP_Name: 'Debt SIP', Fund_Type: 'Debt', Monthly_Amount: 5000, Current_Value: 80000, Expected_Return: 6.0 },
                    { id: 3, SIP_Name: 'Hybrid SIP', Fund_Type: 'Hybrid', Monthly_Amount: 3000, Current_Value: 45000, Expected_Return: 9.0 }
                ],
                transactions: []
            });

            // Load data from localStorage on component mount
            useEffect(() => {
                const savedData = localStorage.getItem('financeData');
                if (savedData) {
                    try {
                        setFinanceData(JSON.parse(savedData));
                    } catch (error) {
                        console.error('Error parsing saved data:', error);
                        setFinanceData(initializeDefaultData());
                    }
                } else {
                    setFinanceData(initializeDefaultData());
                }
                setIsLoading(false);
            }, []);

            // Auto-save to localStorage whenever data changes
            useEffect(() => {
                if (financeData && !isLoading) {
                    localStorage.setItem('financeData', JSON.stringify(financeData));
                }
            }, [financeData, isLoading]);

            // Auto-refresh every 30 seconds
            useEffect(() => {
                const interval = setInterval(() => {
                    const savedData = localStorage.getItem('financeData');
                    if (savedData) {
                        try {
                            const parsedData = JSON.parse(savedData);
                            setFinanceData(parsedData);
                        } catch (error) {
                            console.error('Auto-refresh error:', error);
                        }
                    }
                }, 30000);

                return () => clearInterval(interval);
            }, []);

            if (isLoading || !financeData) {
                return (
                    <div className="flex items-center justify-center min-h-screen">
                        <div className="text-xl font-semibold">Loading your financial data...</div>
                    </div>
                );
            }

            // Calculate totals
            const salary = financeData.personalInfo?.Monthly_Salary || 0;
            const totalExpenses = financeData.monthlyExpenses?.reduce((sum, exp) => sum + (exp.Amount || 0), 0) || 0;
            const totalSIP = financeData.monthlyExpenses?.find(exp => exp.Expense_Category === 'SIP_Investments')?.Amount || 0;
            const remaining = salary - totalExpenses;

            // Handle EMI Payment
            const handleEMIPayment = (loanId, paymentAmount) => {
                setFinanceData(prev => {
                    const newData = { ...prev };
                    const loanIndex = newData.loansTracker.findIndex(loan => loan.id === loanId);
                    
                    if (loanIndex !== -1) {
                        const loan = newData.loansTracker[loanIndex];
                        const newOutstanding = Math.max(0, loan.Outstanding_Amount - paymentAmount);
                        const newTenure = Math.max(0, loan.Remaining_Tenure_Months - 1);
                        
                        newData.loansTracker[loanIndex] = {
                            ...loan,
                            Outstanding_Amount: newOutstanding,
                            Remaining_Tenure_Months: newTenure,
                            Last_Payment_Date: new Date().toISOString().split('T')[0],
                            Payments_Made: [...(loan.Payments_Made || []), {
                                date: new Date().toISOString().split('T')[0],
                                amount: paymentAmount,
                                outstanding_after: newOutstanding
                            }]
                        };

                        // Add transaction record
                        newData.transactions = [...(newData.transactions || []), {
                            id: Date.now(),
                            type: 'EMI_Payment',
                            loan_name: loan.Loan_Name,
                            amount: paymentAmount,
                            date: new Date().toISOString().split('T')[0],
                            description: `EMI payment for ${loan.Loan_Name}`
                        }];
                    }
                    
                    return newData;
                });
                setShowEMIPayment(false);
            };

            // Import Excel file
            const handleFileImport = (event) => {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        try {
                            const data = new Uint8Array(e.target.result);
                            const workbook = XLSX.read(data, { type: 'array' });
                            
                            const excelSheets = {};
                            workbook.SheetNames.forEach(sheetName => {
                                const worksheet = workbook.Sheets[sheetName];
                                const jsonData = XLSX.utils.sheet_to_json(worksheet);
                                excelSheets[sheetName] = jsonData;
                            });

                            // Process Excel data and merge with existing
                            const importedData = {
                                ...financeData,
                                personalInfo: excelSheets.Personal_Info ? 
                                    excelSheets.Personal_Info.reduce((acc, row) => {
                                        acc[row.Field] = row.Value;
                                        return acc;
                                    }, {}) : financeData.personalInfo,
                                monthlyExpenses: excelSheets.Monthly_Expenses?.map((exp, idx) => ({
                                    ...exp,
                                    id: exp.id || idx + 1
                                })) || financeData.monthlyExpenses,
                                loansTracker: excelSheets.Loans_Tracker?.map((loan, idx) => ({
                                    ...loan,
                                    id: loan.id || idx + 1,
                                    Payments_Made: loan.Payments_Made || []
                                })) || financeData.loansTracker,
                                sipInvestments: excelSheets.SIP_Investments?.map((sip, idx) => ({
                                    ...sip,
                                    id: sip.id || idx + 1
                                })) || financeData.sipInvestments
                            };

                            setFinanceData(importedData);
                            alert('Excel data imported successfully!');
                        } catch (error) {
                            console.error('Error importing Excel file:', error);
                            alert('Error importing Excel file. Please check the format.');
                        }
                    };
                    reader.readAsArrayBuffer(file);
                }
            };

            // Export to Excel
            const exportToExcel = () => {
                const wb = XLSX.utils.book_new();
                
                // Personal Info
                const personalInfoWS = XLSX.utils.json_to_sheet([
                    { Field: 'Monthly_Salary', Value: financeData.personalInfo.Monthly_Salary, Notes: 'Current monthly salary' },
                    { Field: 'Name', Value: financeData.personalInfo.Name, Notes: 'Your name' },
                    { Field: 'Last_Updated', Value: new Date().toISOString().split('T')[0], Notes: 'Last update date' }
                ]);
                XLSX.utils.book_append_sheet(wb, personalInfoWS, 'Personal_Info');
                
                // Monthly Expenses
                const expensesWS = XLSX.utils.json_to_sheet(financeData.monthlyExpenses);
                XLSX.utils.book_append_sheet(wb, expensesWS, 'Monthly_Expenses');
                
                // Loans Tracker
                const loansWS = XLSX.utils.json_to_sheet(financeData.loansTracker);
                XLSX.utils.book_append_sheet(wb, loansWS, 'Loans_Tracker');
                
                // SIP Investments
                const sipWS = XLSX.utils.json_to_sheet(financeData.sipInvestments);
                XLSX.utils.book_append_sheet(wb, sipWS, 'SIP_Investments');
                
                // Transactions
                const transactionsWS = XLSX.utils.json_to_sheet(financeData.transactions || []);
                XLSX.utils.book_append_sheet(wb, transactionsWS, 'Transactions');
                
                XLSX.writeFile(wb, 'Finance_Planner_Export.xlsx');
            };

            const manualRefresh = () => {
                const savedData = localStorage.getItem('financeData');
                if (savedData) {
                    try {
                        setFinanceData(JSON.parse(savedData));
                        alert('Data refreshed successfully!');
                    } catch (error) {
                        alert('Error refreshing data');
                    }
                }
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-6">
                    <div className="max-w-7xl mx-auto">
                        {/* Header */}
                        <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
                            <div className="flex justify-between items-center">
                                <div>
                                    <h1 className="text-3xl font-bold text-gray-800">Personal Finance Planner</h1>
                                    <p className="text-gray-600 mt-1">Auto-Sync Financial Dashboard</p>
                                    <div className="flex items-center gap-2 mt-2">
                                        <div className="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                                        <span className="text-sm text-green-600">Auto-refreshing every 30 seconds</span>
                                    </div>
                                </div>
                                <div className="flex gap-3">
                                    <input
                                        type="file"
                                        id="excel-import"
                                        accept=".xlsx,.xls"
                                        onChange={handleFileImport}
                                        className="hidden"
                                    />
                                    <button 
                                        onClick={() => document.getElementById('excel-import').click()}
                                        className="bg-blue-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 hover:bg-blue-700 transition text-sm"
                                    >
                                        <Download size={16} />
                                        Import Excel
                                    </button>
                                    <button 
                                        onClick={manualRefresh}
                                        className="bg-purple-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 hover:bg-purple-700 transition text-sm"
                                    >
                                        <Refresh size={16} />
                                        Refresh
                                    </button>
                                    <button 
                                        onClick={exportToExcel}
                                        className="bg-green-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 hover:bg-green-700 transition text-sm"
                                    >
                                        <Download size={16} />
                                        Export
                                    </button>
                                    <button 
                                        onClick={() => setShowEMIPayment(true)}
                                        className="bg-orange-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 hover:bg-orange-700 transition text-sm"
                                    >
                                        <CreditCard size={16} />
                                        Pay EMI
                                    </button>
                                </div>
                            </div>
                        </div>

                        {/* Navigation Tabs */}
                        <div className="bg-white rounded-lg shadow-lg mb-6">
                            <div className="flex border-b overflow-x-auto">
                                {['overview', 'expenses', 'loans', 'investments', 'transactions'].map(tab => (
                                    <button
                                        key={tab}
                                        onClick={() => setActiveTab(tab)}
                                        className={`px-6 py-4 font-semibold capitalize transition whitespace-nowrap ${
                                            activeTab === tab 
                                                ? 'border-b-4 border-blue-600 text-blue-600' 
                                                : 'text-gray-600 hover:text-blue-600'
                                        }`}
                                    >
                                        {tab}
                                    </button>
                                ))}
                            </div>
                        </div>

                        {/* Overview Tab */}
                        {activeTab === 'overview' && (
                            <>
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                                    <div className="bg-gradient-to-br from-green-500 to-green-600 rounded-lg shadow-lg p-6 text-white">
                                        <h3 className="text-lg font-semibold mb-2">Monthly Income</h3>
                                        <p className="text-3xl font-bold">₹{salary.toLocaleString()}</p>
                                    </div>
                                    
                                    <div className="bg-gradient-to-br from-red-500 to-red-600 rounded-lg shadow-lg p-6 text-white">
                                        <h3 className="text-lg font-semibold mb-2">Total Expenses</h3>
                                        <p className="text-3xl font-bold">₹{totalExpenses.toLocaleString()}</p>
                                    </div>
                                    
                                    <div className="bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg shadow-lg p-6 text-white">
                                        <h3 className="text-lg font-semibold mb-2">SIP Investments</h3>
                                        <p className="text-3xl font-bold">₹{totalSIP.toLocaleString()}</p>
                                    </div>
                                    
                                    <div className="bg-gradient-to-br from-purple-500 to-purple-600 rounded-lg shadow-lg p-6 text-white">
                                        <h3 className="text-lg font-semibold mb-2">Remaining</h3>
                                        <p className="text-3xl font-bold">₹{remaining.toLocaleString()}</p>
                                    </div>
                                </div>

                                {/* Quick Actions */}
                                <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
                                    <h3 className="text-xl font-bold text-gray-800 mb-4">Quick Actions</h3>
                                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                        <button 
                                            onClick={() => setShowEMIPayment(true)}
                                            className="bg-blue-600 text-white p-4 rounded-lg hover:bg-blue-700 transition flex items-center gap-3"
                                        >
                                            <CreditCard size={24} />
                                            <div className="text-left">
                                                <div className="font-semibold">Make EMI Payment</div>
                                                <div className="text-sm opacity-90">Update loan balances</div>
                                            </div>
                                        </button>
                                        <button 
                                            onClick={() => setActiveTab('expenses')}
                                            className="bg-green-600 text-white p-4 rounded-lg hover:bg-green-700 transition flex items-center gap-3"
                                        >
                                            <Plus size={24} />
                                            <div className="text-left">
                                                <div className="font-semibold">Add Expense</div>
                                                <div className="text-sm opacity-90">Track new expenses</div>
                                            </div>
                                        </button>
                                        <button 
                                            onClick={() => setActiveTab('investments')}
                                            className="bg-purple-600 text-white p-4 rounded-lg hover:bg-purple-700 transition flex items-center gap-3"
                                        >
                                            <Plus size={24} />
                                            <div className="text-left">
                                                <div className="font-semibold">Add Investment</div>
                                                <div className="text-sm opacity-90">New SIP or investment</div>
                                            </div>
                                        </button>
                                    </div>
                                </div>
                            </>
                        )}

                        {/* Loans Tab with EMI Management */}
                        {activeTab === 'loans' && (
                            <div className="bg-white rounded-lg shadow-lg p-6">
                                <div className="flex justify-between items-center mb-6">
                                    <h2 className="text-2xl font-bold text-gray-800">Loan Management</h2>
                                    <button 
                                        onClick={() => setShowEMIPayment(true)}
                                        className="bg-blue-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 hover:bg-blue-700 transition"
                                    >
                                        <CreditCard size={16} />
                                        Pay EMI
                                    </button>
                                </div>
                                
                                <div className="overflow-x-auto">
                                    <table className="w-full">
                                        <thead>
                                            <tr className="bg-gray-100 border-b-2 border-gray-300">
                                                <th className="px-6 py-4 text-left text-sm font-bold text-gray-700">Loan Name</th>
                                                <th className="px-6 py-4 text-right text-sm font-bold text-gray-700">EMI Amount</th>
                                                <th className="px-6 py-4 text-right text-sm font-bold text-gray-700">Outstanding</th>
                                                <th className="px-6 py-4 text-right text-sm font-bold text-gray-700">Tenure Left</th>
                                                <th className="px-6 py-4 text-right text-sm font-bold text-gray-700">Last Payment</th>
                                                <th className="px-6 py-4 text-center text-sm font-bold text-gray-700">Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {financeData.loansTracker.map((loan) => (
                                                <tr key={loan.id} className="border-b hover:bg-gray-50">
                                                    <td className="px-6 py-4">
                                                        <div>
                                                            <div className="font-semibold text-gray-800">{loan.Loan_Name}</div>
                                                            <div className="text-sm text-gray-500">{loan.Bank_Lender} • {loan.Interest_Rate}%</div>
                                                        </div>
                                                    </td>
                                                    <td className="px-6 py-4 text-right text-gray-700 font-semibold">₹{loan.EMI_Amount.toLocaleString()}</td>
                                                    <td className="px-6 py-4 text-right">
                                                        <div className="text-red-600 font-semibold">₹{loan.Outstanding_Amount.toLocaleString()}</div>
                                                        <div className="text-xs text-gray-500">
                                                            {((loan.Outstanding_Amount / loan.Principal_Amount) * 100).toFixed(1)}% remaining
                                                        </div>
                                                    </td>
                                                    <td className="px-6 py-4 text-right text-gray-700">{loan.Remaining_Tenure_Months} months</td>
                                                    <td className="px-6 py-4 text-right text-sm text-gray-500">
                                                        {loan.Last_Payment_Date || 'No payments yet'}
                                                    </td>
                                                    <td className="px-6 py-4 text-center">
                                                        <button 
                                                            onClick={() => {
                                                                setEditingLoan(loan);
                                                                setShowEMIPayment(true);
                                                            }}
                                                            className="bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700 transition"
                                                        >
                                                            Pay EMI
                                                        </button>
                                                    </td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        )}

                        {/* Other tabs remain similar to previous implementation */}
                        {activeTab === 'expenses' && (
                            <div className="bg-white rounded-lg shadow-lg p-6">
                                <h2 className="text-2xl font-bold text-gray-800 mb-6">Monthly Expenses</h2>
                                <div className="space-y-4">
                                    {financeData.monthlyExpenses.map((expense) => {
                                        const percentage = (expense.Amount / salary * 100).toFixed(1);
                                        return (
                                            <div key={expense.id} className="border-b pb-4">
                                                <div className="flex justify-between items-center mb-2">
                                                    <div className="flex items-center gap-3">
                                                        <span className="font-semibold text-gray-700">
                                                            {expense.Expense_Category.replace(/_/g, ' ')}
                                                        </span>
                                                        <span className={`px-2 py-1 rounded text-xs font-semibold ${
                                                            expense.Priority === 'High' ? 'bg-red-100 text-red-800' :
                                                            expense.Priority === 'Medium' ? 'bg-yellow-100 text-yellow-800' :
                                                            'bg-green-100 text-green-800'
                                                        }`}>
                                                            {expense.Priority}
                                                        </span>
                                                    </div>
                                                    <span className="text-xl font-bold text-gray-800">₹{expense.Amount.toLocaleString()}</span>
                                                </div>
                                                <div className="w-full bg-gray-200 rounded-full h-3">
                                                    <div 
                                                        className="bg-blue-600 h-3 rounded-full transition-all duration-500"
                                                        style={{ width: `${percentage}%` }}
                                                    ></div>
                                                </div>
                                                <span className="text-sm text-gray-500 mt-1">{percentage}% of income</span>
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>
                        )}

                        {activeTab === 'investments' && (
                            <div className="bg-white rounded-lg shadow-lg p-6">
                                <h2 className="text-2xl font-bold text-gray-800 mb-6">SIP Investments</h2>
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                                    {financeData.sipInvestments.map((sip) => (
                                        <div key={sip.id} className="bg-gradient-to-br from-green-50 to-emerald-50 rounded-lg p-6 border-2 border-green-200">
                                            <h3 className="font-bold text-gray-800 text-lg mb-2">{sip.SIP_Name}</h3>
                                            <p className="text-3xl font-bold text-green-600 mb-2">₹{sip.Monthly_Amount.toLocaleString()}</p>
                                            <div className="space-y-2">
                                                <span className={`inline-block px-3 py-1 rounded-full text-sm font-semibold ${
                                                    sip.Fund_Type === 'Equity' ? 'bg-red-100 text-red-800' :
                                                    sip.Fund_Type === 'Debt' ? 'bg-blue-100 text-blue-800' :
                                                    'bg-purple-100 text-purple-800'
                                                }`}>
                                                    {sip.Fund_Type}
                                                </span>
                                                <p className="text-sm text-gray-600">Current Value: ₹{sip.Current_Value.toLocaleString()}</p>
                                                <p className="text-sm text-gray-600">Expected Return: {sip.Expected_Return}%</p>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {activeTab === 'transactions' && (
                            <div className="bg-white rounded-lg shadow-lg p-6">
                                <h2 className="text-2xl font-bold text-gray-800 mb-6">Transaction History</h2>
                                {financeData.transactions && financeData.transactions.length > 0 ? (
                                    <div className="space-y-4">
                                        {financeData.transactions.slice().reverse().map((transaction) => (
                                            <div key={transaction.id} className="border rounded-lg p-4 flex justify-between items-center">
                                                <div>
                                                    <div className="font-semibold text-gray-800">{transaction.description}</div>
                                                    <div className="text-sm text-gray-500">{transaction.date}</div>
                                                </div>
                                                <div className="text-right">
                                                    <div className="font-bold text-red-600">-₹{transaction.amount.toLocaleString()}</div>
                                                    <div className="text-sm text-gray-500">{transaction.type}</div>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                ) : (
                                    <div className="text-center py-12">
                                        <p className="text-gray-500 text-lg">No transactions yet. Make your first EMI payment!</p>
                                    </div>
                                )}
                            </div>
                        )}

                        {/* EMI Payment Modal */}
                        {showEMIPayment && (
                            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                                <div className="bg-white rounded-lg p-6 w-full max-w-md">
                                    <h3 className="text-xl font-bold text-gray-800 mb-4">Make EMI Payment</h3>
                                    
                                    {editingLoan ? (
                                        <EMIPaymentForm 
                                            loan={editingLoan} 
                                            onPayment={handleEMIPayment}
                                            onClose={() => {
                                                setShowEMIPayment(false);
                                                setEditingLoan(null);
                                            }}
                                        />
                                    ) : (
                                        <LoanSelector 
                                            loans={financeData.loansTracker}
                                            onSelectLoan={(loan) => setEditingLoan(loan)}
                                            onClose={() => setShowEMIPayment(false)}
                                        />
                                    )}
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // EMI Payment Form Component
        const EMIPaymentForm = ({ loan, onPayment, onClose }) => {
            const [paymentAmount, setPaymentAmount] = useState(loan.EMI_Amount);
            const [paymentDate, setPaymentDate] = useState(new Date().toISOString().split('T')[0]);

            const handleSubmit = (e) => {
                e.preventDefault();
                if (paymentAmount > 0) {
                    onPayment(loan.id, parseFloat(paymentAmount));
                    alert(`EMI payment of ₹${paymentAmount} made for ${loan.Loan_Name}`);
                }
            };

            return (
                <form onSubmit={handleSubmit} className="space-y-4">
                    <div>
                        <label className="block text-sm font-semibold text-gray-700 mb-2">
                            Loan: {loan.Loan_Name}
                        </label>
                        <div className="text-sm text-gray-500">
                            Outstanding: ₹{loan.Outstanding_Amount.toLocaleString()} | 
                            Tenure Left: {loan.Remaining_Tenure_Months} months
                        </div>
                    </div>
                    
                    <div>
                        <label className="block text-sm font-semibold text-gray-700 mb-2">Payment Amount</label>
                        <input
                            type="number"
                            value={paymentAmount}
                            onChange={(e) => setPaymentAmount(e.target.value)}
                            className="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
                            placeholder="Enter payment amount"
                            min="0"
                            step="0.01"
                        />
                    </div>
                    
                    <div>
                        <label className="block text-sm font-semibold text-gray-700 mb-2">Payment Date</label>
                        <input
                            type="date"
                            value={paymentDate}
                            onChange={(e) => setPaymentDate(e.target.value)}
                            className="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
                        />
                    </div>
                    
                    <div className="flex gap-3 pt-4">
                        <button
                            type="submit"
                            className="flex-1 bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition font-semibold"
                        >
                            Make Payment
                        </button>
                        <button
                            type="button"
                            onClick={onClose}
                            className="flex-1 bg-gray-300 text-gray-700 py-2 rounded-lg hover:bg-gray-400 transition font-semibold"
                        >
                            Cancel
                        </button>
                    </div>
                </form>
            );
        };

        // Loan Selector Component
        const LoanSelector = ({ loans, onSelectLoan, onClose }) => (
            <div className="space-y-4">
                <h4 className="text-lg font-semibold text-gray-800">Select Loan for Payment</h4>
                <div className="space-y-2">
                    {loans.map((loan) => (
                        <button
                            key={loan.id}
                            onClick={() => onSelectLoan(loan)}
                            className="w-full text-left border border-gray-300 rounded-lg p-4 hover:bg-gray-50 transition"
                        >
                            <div className="flex justify-between items-center">
                                <div>
                                    <div className="font-semibold text-gray-800">{loan.Loan_Name}</div>
                                    <div className="text-sm text-gray-500">EMI: ₹{loan.EMI_Amount.toLocaleString()}</div>
                                </div>
                                <div className="text-right">
                                    <div className="text-red-600 font-semibold">₹{loan.Outstanding_Amount.toLocaleString()}</div>
                                    <div className="text-sm text-gray-500">{loan.Remaining_Tenure_Months} months</div>
                                </div>
                            </div>
                        </button>
                    ))}
                </div>
                <button
                    onClick={onClose}
                    className="w-full bg-gray-300 text-gray-700 py-2 rounded-lg hover:bg-gray-400 transition font-semibold"
                >
                    Cancel
                </button>
            </div>
        );

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<FinancePlanner />);
    </script>
</body>
</html>